
\begin{abstract}
  Polynomial functors are sums of covariant representable functors from the
  category of sets to itself. They have a robust theory with many applications
  --- from operads and opetopes to combinatorial species. In this paper, we
  define a contravariant analogue of polynomial functors: Dirichlet functors. We
  develop the basic theory of Dirichlet functors, and relate them to their
  covariant analogues.
\end{abstract}

\section{Introduction}
A polynomial functor $P : \Set \to \Set$ is a sum of representables
\begin{equation}\label{eqn.poly}
P(X) := \sum_{b \in B} X^{E_b}
\end{equation}
where the family of sets $E_b$ depends on $b\in B$. This data is known
in the computer science literature as a ``container'', but since such an indexed
family of sets can be represented by as a function
\[
  \begin{tikzcd}
    E \arrow[d, "\pi"] \\
    B
  \end{tikzcd}
\]
we will refer to it as a \emph{bundle}.

Remarkably, all natural transformations between polynomial functors can be
represented in terms of their associated bundles. A natural transformation $P
\to P'$ corresponds to a pair of functions%
\footnote{We use dependent type syntax, in particular Idris$^?$.}
\[
\left( f : B \to B',\, f^{\sharp} : \dprod{b : B} E'_{fb} \to E_b \right)
\]
noting that $f$ acts covariantly on the base and $f^\sharp$ acts contravariantly on
fibers. 
In terms of bundles, this is a diagram of the following sort:
\[
  \begin{tikzcd}
    E \arrow[d, "\pi"'] \arrow[r, leftarrow, "f_{\sharp}"] & \bullet \arrow[d] \arrow[r]
    \arrow[dr, phantom, "\ulcorner" very near start] & E' \arrow[d, "\pi'"] \\
    B \arrow[r, equals] & B \arrow[r, "f"'] & B'
  \end{tikzcd}
\]
We refer to these special spans as \emph{contravariant} morphisms of bundles.

\begin{thm}[cite]
The category of polynomial functors and natural transformations is equivalent to
the category of bundles and contravariant morphisms.
\end{thm}

This begs the question: what, then, are we to make of the more obvious,
\emph{covariant} morphisms of bundles
\[
  \begin{tikzcd}[column sep=large]
E \arrow[r, "\term{tot}(f_{\sharp})"] \arrow[d, "\pi"'] & E' \arrow[d, "\pi'"] \\
B \arrow[r, "f"']                                       & B'                  
\end{tikzcd}
\]
for which $f_\sharp$ is covariant
in each fibers.

It turns out that these covariant maps of bundles correspond to natural
transformations between the appropriate sums of \emph{contravariant}
representables:
$$D(S) := \sum_{b \in B} E_b^S$$

Polynomial functors as in \eqref{eqn.poly} get their name from the case in which
$B$ and $E$ are finite sets. Consider the function $\term{card}~E_{(-)} : B \to
\Nb$, which takes the cardinality of each fiber $E_b$. Letting $B_n :=
(\term{card}E_{(-)})\inv(n)$, i.e.\ $B_n$ is the set of elements whose fibers have $n$ elements,
we find that the for any set $X$, the cardinality
$$|P(X)| = \sum_{n \in \Nb} |B_n||X|^n$$
is a polynomial in the cardinality of $X$. Similarly,
$$|D(S)| = \sum_{n \in \Nb} |B_n|n^{|S|}$$
resembles a Dirichlet series in the cardinality of $S$ -- without the usual
negative sign.\footnote{Future work of the first author will recover the
  negative sign by generalizing the theory of Dirichlet functors to homotopy
  types.} Accordingly, we call such
sums of contravariant representables \emph{Dirichlet functors}.

We will show in this paper that Dirichlet functors are, quite robustly, the
contravariant analogue of polynomial functors. In particular, the many equivalent ways to
say that a functor is polynomial have contravariant analogues.
\begin{thm}[cite]\label{thm:polynomial.set.characterization}
  Let $P : \Set \to \Set$ be a functor. Then the following are equivalent.
  \begin{enumerate}
  \item $P$ is polynomial.
  \item $P$ is the sum of covariant representables.
  \item There is a bundle $\pi : E \to B$ together with a natural isomorphism
    $$P(X) \cong \sum_{b \in B} X^{E_b}.$$
    Or, equivalently, a natural isomorphism of $P$ with the composite
    $$\Set \xto{{\Delta_{!_E}}} \Set_{/E} \xto{{\Pi_\pi}} \Set_{/B} \xto{{\Sigma_{!_B}}} \Set.$$
  \item $P$ is accessible and preserves connected limits.
  \end{enumerate}
\end{thm}

Analogously, we will prove the following theorem.
\begin{thm}
Let $D : \Set\op \to \Set$ be a contravariant functor. Then the following are
equivalent.
\begin{enumerate}
\item $D$ is Dirichlet.
\item $D$ is the sum of contravariant representables.
\item There is a bundle $\pi : E \to B$ together with a natural isomorphism
  $$D(X) \cong \sum_{b \in B} E_b^X.$$
  Or, equivalently, a natural isomorphism of $D$ with the composite
  $$\Set\op \xto{(\Delta_{!_B})\op} (\Set_{/B})\op \xto{[-, \pi]} \Set_{/B}
  \xto{\Sigma_{!_B}} \Set.$$
\item $D$ preserves connected limits.
\end{enumerate}
\end{thm}

Note that we no longer need to assume accessiblity. This is a general feature of
the theory of Dirichlet functors; it is a bit ``smaller'' and more manageable
than that of polynomials. In particular, a Dirichlet functor is determined by
its action on the terminal morphism $!_0 : 0 \to \ast$ of the empty set. As a corollary, Dirichlet functors form a topos.

\begin{thm}\label{thm:dirichlet.set.equivalence}
The functor $\Set^{\down} \to \type{Fun}(\Set\op, \Set)$, given by sending $\pi : E
\to B$ to the induced Dirichlet functor $X \mapsto \sum_{b \in B} E_b^X$, is
fully faithful, and so gives an equivalence
$$\Set^{\down} \simeq \Dir$$
between the topos of bundles and the category of Dirichlet functors, with inverse given by evalutation at
$!_0 : 0 \to \ast$.
\end{thm}


Now, object-wise, a Dirichlet functor and a polynomial functor are determined by
the same data --- a bundle $\pi : E \to B$ of sets. Accordingly, one would
expect for any set $N$ a transformation
$$X^N \mapsto N^X$$
turning polynomial functors into Dirichlet functors, and vice versa. But the
natural transformations between each sort of functor induce different morphisms
between the bundles; natural transformations between polynomial functors induce
contravariant bundle morphisms, while natural transformations between Dirichlet
functors induce covariant bundle morphisms. However, if we restrict to those
morphisms of bundles which are \emph{isovariant} on the fibers --- that is, the
pullback diagrams of the form
\[
  \begin{tikzcd}[column sep=large]
E \arrow[r, "\term{tot}(f_{\sharp})"] \arrow[d, "\pi"'] \arrow[dr, phantom,
"\ulcorner" very near start] & E' \arrow[d, "\pi'"] \\
B \arrow[r, "f"']                                       & B'                  
\end{tikzcd}
\]
which preserve the number of elements in each row --- we find that such a morphism
is both a co- and contravariant morphism of bundles. It is well known that such
\emph{cartesian} morphisms of bundles correspond to \emph{cartesian} natural
transformations between polynomial functors (cite) --- those whose naturality
squares are pullbacks. This is true as well for Dirichlet functors.
\begin{thm}
A natural transformation $D \to D'$ of Dirichlet functors is Cartesian if and
only if the corresponding bundle map
\[
  \begin{tikzcd}[column sep=large]
E \arrow[r, "\term{tot}(f_{\sharp})"] \arrow[d, "\pi"'] \arrow[dr, phantom,
"\ulcorner" very near start] & E' \arrow[d, "\pi'"] \\
B \arrow[r, "f"']                                       & B'                  
\end{tikzcd}
\]
is a pullback. As a corollary, we have an equivalence of categories
$$\type{Poly}_{\ulcorner} \simeq \Dir_{\ulcorner}$$
between polynomial functors with cartesian natural transfromations and Dirichlet
functors with cartesian natural transfromations.
\end{thm}



\begin{acknowledgements}

\end{acknowledgements}


\section{Dirichlet Functors} \label{sec:set.level}

Before diving in to the theory of Dirichlet functors, let's first consider the
category $\Set^{\down}$ of bundles of sets and univariant bundle maps. For our
proofs to go smoothly, we will need to explicitly keep track of the
self-dualizing isomorphism $\downarrow \xto{\sim} \downarrow\op$ on the walking arrow.

\begin{defn}
  We let $\downarrow$ be the walking arrow --- the category $\term{dom} \to
  \term{cod}$ consisting of a single morphism. We denote by $\sigma : \downarrow
  \to \downarrow\op$ the self-dualizing isomorphism of $\downarrow$, and note
  that $\sigma\inv = \sigma\op$.
\end{defn}

\begin{prop}\label{prop:adjoint.sextuple}
  There is an adjoint sextuple:
  \[
    \begin{tikzcd}
      \Set \arrow[r, "\const"] \arrow[r, leftarrow, shift left = 5,
      "\term{cod}"] \arrow[r, leftarrow, shift right = 5, "\term{dom}"]
      \arrow[r, shift left = 10, "!^{(-)}"]  \arrow[r, shift right = 10,
      "!_{(-)}"] \arrow[r, leftarrow, shift left = 15, "\term{ZC}"]& \Set^{\down}
    \end{tikzcd}
  \]
  All three functors $\Set \to \Set^{\down}$ are fully faithful.
\end{prop}
\begin{proof}
There is an adjoint triple $\begin{tikzcd} \ast \arrow[r,leftarrow] \arrow[r,
  bend left] \arrow[r, bend right] & \down \end{tikzcd}$. The middle three
functors---$\term{cod}$, $\const$, and $\term{dom}$---are given by restricting along this adjoint triple; the outer two are
given by Kan extending, or more concretely:
  \begin{equation}\label{eqn.bangbang}
  X \mapsto \begin{tikzcd} 0 \arrow[d, "!^X"] \\ X \end{tikzcd}
  \qquad\text{and}\qquad
  X \mapsto \begin{tikzcd} X \arrow[d, "!_X"] \\ \ast \end{tikzcd}
  \end{equation}
 It is easy to see that the unit $X \to \term{dom} !_{X}$ is an isomorphism (it is in
fact an identity), so $!_{(-)}$ is fully faithful. Therefore, all three functors
going from $\Set \to \Set^{\down}$ are fully faithful.

The existence of the final adjoint can be deduced from the fact that $!^{(-)}$ preserves all
limits. It sends a bundle $\pi : E \to B$ to the largest subset $\term{ZC}(B)$ of $B$ for
which the following square is a pullback
\[
  \begin{tikzcd}[column sep=large]
0 \arrow[r] \arrow[d] \arrow[dr, phantom,
"\ulcorner" very near start] & E \arrow[d, "\pi"] \\
\term{ZC}(B) \arrow[r, hookrightarrow]                                       & B
\end{tikzcd}
\]
\end{proof}

We prove a few quick facts we will use later.
\begin{lem}\label{lem:bang.preserves.connected.colimits}
  The functor $!_{(-)}\colon\Set\to\Set^{\down}$ from \eqref{eqn.bangbang} preserves connected colimits.
\end{lem}
\begin{proof}
  To see that $!_{(-)}$ preserves connected colimits, recall that colimits in $\Set^{\down}$ are calculated pointwise. It remains to show, then, that the map of bundles
  \[
    \begin{tikzcd}
    \colim S_i \arrow[r, equals] \arrow[d] & \colim S_i \arrow[d] \\
    \colim \ast \arrow[r] & \ast 
    \end{tikzcd}
  \]
  is an isomorphism in $\Set^{\down}$, for which it suffices to show that
  $\colim \ast$ is terminal. But the colimit of a diagram of terminal objects is the set
  of connected components of its indexing category. Since we assumed the
  indexing category was connected, this contains a single element.
\end{proof}

\begin{lem}\label{lem:set.bundle.yoneda}
The Yoneda embedding $\yo : \downarrow\op \to \Set^{\downarrow}$ is equal to the
composite $$\downarrow\op \xto{\sigma\op} \downarrow \xto{!_{0}} \Set
\xto{!_{(-)}} \Set^{\downarrow}.$$

As a corollary, any $\pi : \downarrow \to \Set$ equals the composite
$$\downarrow \xto{\sigma} \downarrow\op \xto{!_0\op} \Set\op \xto{!_{(-)}\op}
(\Set^{\downarrow})\op \xto{\Set^{\downarrow}(-, \pi)} \Set$$
by the Yoneda lemma.
\end{lem}
\begin{proof}
One checks directly.
\end{proof}

Now we will define the \emph{extent} of a bundle $\pi$ to be the Dirichlet functor $\ext_\pi: \Set\to\Set$ that it
corresponds to. This sends a bundle
$\pi : E \to B$ to the functor
$$X \mapsto \sum_{b \in B} E_b^X.$$
We will, however, give a more abstract definition of the extent, and then
calculate a number of presentations of it.

\begin{defn}\label{def.extent}
  Consider the functor $!_0\op \circ \sigma : \down \to \Set\op$ picking out the
  unique morphism $1\to 0$ in $\Set\op$. Sending a functor $\Set\op\to\Set$ to
  its precomposition with $!_0\op \sigma$ gives an evaluation functor
  $$\Set^{\down} \xleftarrow{\ev_{!_0}} \Fun(\Set\op, \Set).$$
  This functor admits a right adjoint by right Kan extension along $!_0\op \circ
  \sigma : \downarrow \to \Set\op$; we define the
  \emph{Dirichlet extent} functor $\ext : \Set^{\down} \to \Fun(\Set\op,
  \Set)$ to be this right adjoint. It sends any bundle $\pi$ to
  $$\ext_{\pi} :\equiv \term{ran}_{!_0\op \circ \sigma} \pi.$$
\end{defn}


\begin{prop}\label{prop:set.characterizing.extent}
  Let $\pi : E \to B$ be a bundle. The following are equivalent:
  \begin{enumerate}
  \item The extent $\ext_{\pi} : \Set\op \to \Set$ of $\pi$ from \cref{def.extent}.
  \item The functor
    $$S \mapsto \sum_{b \in B} E_b^S,$$
    or equivalently the composite
  $$\Set\op \xto{(B^{\ast})\op} (\Set_{/B})\op \xto{[-, \pi]} \Set_{/B}
  \xto{B_{\ast}} \Set.$$
\item The pullback in $\Fun(\Set\op, \Set)$:  
\[
\begin{tikzcd}
	\ext_\pi \ar[r]\ar[d]\arrow[dr, phantom,
      "\ulcorner" very near start]&
	B\ar[d]\\
	\Set(-,E)\ar[r]&
	\Set(-,B)
\end{tikzcd}
\]
\item The restricted representable functor
  $\Set^{\down}(!_{(-)}, \pi)$.
\item The functor
  $$S \mapsto \lim(\Hom_{\Set}(!_0, S)\op \to \down\op \xto{\sigma\op} \down \xto{\pi} \Set)$$
  where $\Hom_{\Set}(!_0, S)$ is the slice category of $!_0 : \down \to
  \Set$ over $S$.
\item The functor
  $$S \mapsto \lim(( S^{\triangleleft} )\op \xto{( !^{\triangleleft} )\op}
  (\ast^{\triangleleft})\op \xto{\sigma\op} \down
  \xto{\pi} \Set)$$
  where $(-)^{\triangleleft}$ is the \emph{left cone} 2-functor, adjoining an initial object.
  \end{enumerate}
\end{prop}
\begin{proof}
We have presented these results in order of most understandable to most
computational; we will prove it a somewhat opposite order.

First, we note that 
$$S \mapsto \lim(\Hom_{\Set\op}(S, !_0\op \circ \sigma) \to \down \xto{\pi} \Set)$$
is the right Kan extension formula for $\ext_{\pi} \equiv
\term{ran}_{!_0} \pi$ --- see Corollary 9.5.3 of \cite{RV:Elements}. Now,
$\Hom_{\Set\op}(S, !_0\op \circ \sigma) \simeq \Hom_{\Set}(!_0 \circ \sigma\op,
S)\op$ over $\down$, which we may see by noting that $(-)\op : {\infty}\Cat \to {\infty}\Cat^{\term{co}}$ is a cosmological equivalence and therefore preserves
comma squares. Furthermore, we have the following equivalence:
\[
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZABgBpiBdUkANwEMAbAVxiRAB12AJCAWwH1gnLnQC+ACgCE-YgAJOAYywAnBfPbYA5rzqcIaUrIDKASj1oQo0uky58hFGQCMVWoxZthfQcLFSZhqbmltYgGNh4BERO5K70zKyIHOxQEADuhFY2EfbRpC7U8R5JnKkZwaKuMFCa8ESgAGbKfEhkIDgQSDEgDHQARjAMAAq2kQ4gyliaABY4IIXuicnYvCGNzauIbR1IAExZIE0tiLvUO4gAzAsJnhpTOmuHG11nnZeVokA
\begin{tikzcd}
{\Hom_{\Set}(!_0 \circ \sigma\op, S)\op} \arrow[d, "\sim"'] \arrow[r] & \down \arrow[d, "\sigma"] \\
{\Hom_{\Set}(!_0, S)\op} \arrow[r]                                    & \down\op                 
\end{tikzcd}
\]
and therefore we may equivalently calculate this limit as 
$$\lim(\Hom_{\Set}(!_0, S)\op \to \down\op \xto{\sigma\op} \down \xto{\pi} \Set).$$
This gives us the equivalence between (1) and (5).

Now, the comma category $\Hom_{\Set}(!_0, S)$ simply adjoins an initial object
to (the discrete category) $S$. Therefore, we find that (5) and (6) are equivalent.

Now, we note that every set $S$ is the colimit of the diagram $S^{\triangleleft}
\xto{\ast^{\triangleleft}}\down \xto{!_0} \Set$, namely:
\[
% https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZABgBoBGAXVJADcBDAGwFcYkRyQBfU9TXfIRTkK1Ok1btOPPtjwEiAZlE0GLNog7deIDHMFEALCvHqp22QIUoATCbWTNAHScBjKBBwIZu-vKHIdjZiDhogxBa++taBpMQhEmEAGtxiMFAA5vBEoABmAE4QALZIAKw0OBBIxD4FxWUVVYjktYUliOUglUg2rfUdjUiKfe1kXU0AbCNIIuNIUzp17XZziAt5bUODa1yUXEA
\begin{tikzcd}
              &              & S                                               &              &               \\
1 \arrow[rru] & 1 \arrow[ru] & \cdots                                          & 1 \arrow[lu] & 1 \arrow[llu] \\
              &              & 0 \arrow[llu] \arrow[lu] \arrow[ru] \arrow[rru] &              &              
\end{tikzcd}
\]
Since, by Lemma \ref{lem:bang.preserves.connected.colimits}, $!_{(-)}$
preserves connected colimits, we may make the following identification of (4)
with (6) using Lemma \ref{lem:set.bundle.yoneda}: 
\begin{align*}
  \Set^{\down}(!_S, \pi) &= \Set^{\down}(!_{\colim(S^{\triangleleft} \xto{!^{\triangleleft}} \ast^{\triangleleft} \xto{!_0} \Set)}, \pi) \\
  &\simeq \Set^{\down}(\colim(S^{\triangleleft} \xto{!^{\triangleleft}} \ast^{\triangleleft} \xto{!_0} \Set \xto{!_{(-)}} \Set^{\down}), \pi)\\
&\simeq \lim((S^{\down})\op \xto{(!^{\triangleleft})\op} (\ast^{\triangleleft})\op \xto{!_0\op} \Set\op \xto{!_{(-)}} (\Set^{\down})\op \xto{\Set^{\down}(-, \pi)} \Set) \\
&\simeq \lim((S^{\down})\op \xto{(!^{\triangleleft})\op} (\ast^{\triangleleft})\op \xto{\sigma\op} \down \xto{\pi} \Set).
\end{align*}

We see that (3) is equivalent to (4) by noting that the following square of
natural transformations is a pullback:
\[
\begin{tikzcd}
{\Set^{\downarrow}(-, -)} \arrow[d] \arrow[r] \arrow[rd, phantom, "\ulcorner" very near start] & {\Set(\cod(-), \cod(-))} \arrow[d] \\
{\Set(\dom(-), \dom(-))} \arrow[r]                       & {\Set(\dom(-), \cod(-))}          
\end{tikzcd}
\]
and restricting the right side to $\pi$ and the left side to $!_{(-)}$.

Finally, we note that the set $\Set^{\down}(!_S, \pi)$ is naturally
isomorphic to the set $\sum_{b \in B} E_b^S$, letting us identify (4) with (2).
\end{proof}

Now we are ready to intrinsically characterize the Dirichlet functors.
\begin{defn}
A \emph{Dirichlet functor} is a contravariant functor $D : \Set\op \to \Set$
which preserves connected limits. We denote by $\Dir$ the category of Dirichlet functors and natural transformations.
\end{defn}


\begin{thm}\label{thm:dirichlet.set.characterization}
  The functor $\ext$ is fully faithful, and gives an equivalence
  $$\Set^{\down} \simeq \Dir.$$

  As a corollary, the category of Dirichlet functors is a topos.
\end{thm}
\begin{proof}
Since $!_0 : \down \to \Set\op$ is fully faithful, the counit of the
$\ev_{!_0} \vdash \ext$ adjunction --- which is the universal cell defining the
right Kan extension --- is an isomorphism. 
  
Now, we show that a functor is Dirichlet if and only if it is the extent of a bundle. If $D$ is
the extent of a bundle, then by Prop \ref{prop:set.characterizing.extent}, $D$ is naturally
isomorphic to the restricted representable $\Set^{\down}(!_{(-)})$. By Lemma
\ref{lem:bang.preserves.connected.colimits}, this sends connected colimits in $\Set$ to
connected limits.

Now, we show that if $D$ is Dirichlet, then the unit
$D \to \ext_{D!_0}$ is an isomorphism. By Prop
\ref{prop:set.characterizing.extent}, 
  $$\ext_{D!_0}(S) = \lim(S^{\triangleleft} \xto{!^{\triangleleft}} \ast^{\triangleleft}
  \xto{D!_0} \Set).$$
  
Every set $S$ is the connected colimit of the diagram $S^{\triangleleft} \to
\down \xto{!_0} \Set$, and therefore if $D$ preserves this limit, then
$D(S)$ is precisely the above limit $\ext_{D!_0}(S)$.
\end{proof}

\begin{rmk}
The six adjoints of Proposition \ref{prop:adjoint.sextuple} correspond, under
the equivalence of Theorem \ref{thm:dirichlet.set.characterization}, to
\begin{align*}
  \term{ZC}(D) &\sim \mbox{the coefficient of $0^S$ in $D$.}\\
  !^{C} &\sim S \mapsto C \times 0^S \\
  \cod(D) &\sim D(0) \\
  \const(C) &\sim S \mapsto C \\
  \dom(D) &\sim D(1) \\
  !_{C} &\sim S \mapsto C^S \\
\end{align*}
In particular, $!_{(-)}$ corresponds to the Yoneda embedding.
\end{rmk}

\section{Cartesian Transformations between Dirichlet Functors}
In this section, we turn to cartesian transformations between Dirichlet
functors. We will show that the category of Dirichlet functors and cartesian
transfromations are equivalent to the category of Polynomial functors and
cartesian transformations.

\begin{prop}
A natural transformation $\phi : D \to D'$ between Dirichlet functors is
cartesian if and only if the induced bundle map $D!_0 \to D'!_0$ is a pullback.

As a corllary, the equivalence $\Dir \simeq \Set^{\down}$ restricts to an
equivalence
$$\Dir_{\ulcorner} \simeq \Set^{\down}_{\ulcorner}$$
between Dirichlet functors with cartesian natural transformations and bundles with
pullback squares.
\end{prop}
\begin{proof}
We want to show that for any $f\colon D\to D'$ the square
\begin{equation}\label{eqn.cart1}
\begin{tikzcd}
	D(1)\ar[r, "f_1"]\ar[d, "\pi"']&
	D'(1)\ar[d, "\pi'"]\\
	D(0)\ar[r, "f_0"']&
	D'(0)
\end{tikzcd}
\end{equation}
is a pullback in $\Set$ iff for all functions $g\colon X\to X'$, the naturality square
\begin{equation}\label{eqn.cart2}
\begin{tikzcd}
  D(X')\ar[r, "f_{X'}"]\ar[d, "D(g)"']&
  D'(X')\ar[d, "D'(g)"]\\
  D(X)\ar[r, "f_X"']&
  D'(X)
\end{tikzcd}
\end{equation}
is a pullback in $\Set$. We will freely use the natural isomorphism
$D(X)\cong\Set^{\down}(!_X, D!_0)$ from
\ref{prop:set.characterizing.extent}, which allows us to identify Diagram
\ref{eqn.cart2} with
\begin{equation}\label{eqn.cart3}
\begin{tikzcd}
 \Set^{\down}(!_{X'}, D!_0)     \ar[r, "f_{!_0,\ast}"]\ar[d, "!_g^{\ast}"']& \Set^{\down}(!_{X'}, D'!_0)
  \ar[d, "!_{g}^{\ast}"]\\
  \Set^{\down}(!_{X}, D!_0)\ar[r, "f_{!_0, \ast}"']&
 \Set^{\down}(!_X, D'!_0) 
\end{tikzcd}
\end{equation}

The square in Diagram \ref{eqn.cart1} is a
special case of that in Diagram \ref{eqn.cart2}, namely for $g\coloneqq !_0$;
this establishes the only-if direction. 

To complete the proof, suppose that Diagram \ref{eqn.cart1} is a pullback, take an arbitrary $g\colon X\to X'$, and suppose given a commutative solid-arrow diagram as shown:
\[
\begin{tikzcd}[sep=small]
  X\ar[rr, "g"]\ar[dd]\ar[rd]&&
  X'\ar[dr]\ar[dd]\ar[dl, dotted]\\&
  D(1)\ar[rr, crossing over]&&
  D'(1)\ar[dd]\\
  1\ar[dr]\ar[rr, equal]&&
  1\ar[dr]\ar[dl, dotted]\\&
  D(0)\ar[from=uu, crossing over]\ar[rr]&&
  D'(0)
\end{tikzcd}
\]
We can interpret the statement that Diagram \ref{eqn.cart3} is a pullback as
saying that there are unique dotted arrows making the diagram commute. So, we need to show that if the front face is a pullback, then there are unique diagonal dotted arrows as shown, making the diagram commute. This follows quickly from the universal property of the pullback.
\end{proof}

\begin{thm}\label{thm:set.poly.cart.equiv.dir.cart}
  There is an equivalence of categories
  $$\type{Poly}_{\ulcorner} \simeq \Dir_{\ulcorner}$$
  between the category of polynomial functors and cartesian transformations and
  Dirichlet functors and cartesian transformations. This equivlalence sends
  representables to representables
  $$(-)^N \mapsto N^{(-)}.$$
\end{thm}
\begin{proof}
  \jaz{Need to find a good citation for this result --- that polynomial functors
  and cartesian transforms are bundles and cartesian maps (for 1-cats).}
\end{proof}

\begin{cor}
  Let $D$ be a Dirichlet functor. Then the category
  $\Dir_{/_{\ulcorner} D}$
  of Dirichlet functors with a cartesian map to $D$ is a topos.
\end{cor}
\begin{proof}
By Theorem \ref{thm:set.poly.cart.equiv.dir.cart}, this category is equivalent
to $\type{Poly}_{/_{\ulcorner} P}$ for a polynomial $P$. But this is a topos as
observed in Remark 2.6.2 of \cite{GHK:Analytic.Monads}.
\end{proof}

Now, since $\Dir$ is a topos, so is $\Dir_{/D}$. And, as we saw above,
$\Dir_{/_{\ulcorner} D}$ is a topos as well. What is the relationship between
$\Dir_{/D}$ and $\Dir_{/_{\ulcorner} D}$?

We will show that $\Dir_{/_{\ulcorner} D}$ is a subtopos of $\Dir_{/D}$ with the
lex localization given by the vertical / cartesian factorization system on $\Set^{\down}$.

\begin{thm}
  For any $\pi : \down \to \Set$, we have a subtopos inclusion
  $$\Set^{\down}_{/_{\ulcorner} \pi} \hookrightarrow \Set^{\down}_{/\pi}$$

  with lex localization given by:
  \[
\begin{tikzcd}
E' \arrow[r] \arrow[d] & E \arrow[d, "\pi"] \\
B' \arrow[r]           & B                 
\end{tikzcd} \quad\quad\mapsto\quad\quad
\begin{tikzcd}
E' \arrow[d] \arrow[r, dashed]    & \bullet \arrow[d] \arrow[r] \arrow[rd, phantom, "\ulcorner" very near start] & E \arrow[d, "\pi"] \\
B' \arrow[r, equals] & B' \arrow[r]                           & B                 
\end{tikzcd}
  \]
  As a corollary, $\Dir_{/_{\ulcorner} D} \hookrightarrow \Dir_{D}$ is a
  subtopos inclusion.
\end{thm}
\begin{proof}
We have displayed both the action of the left localization and its unit. The
counit is always an isomorphism since pullbacks are unique up to unique
isomorphism.

That this is lex follows quickly from the fact that taking pullbacks commutes
with taking limits. 
\end{proof}









